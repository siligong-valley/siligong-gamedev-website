---
import { getCollection } from "astro:content";
import Layout from "../layouts/Layout.astro";
import Hero from "../components/Hero.tsx";
import About from "@/components/About";
import Events from "@/components/Events.tsx";
import Community from "@/components/Community.tsx";
import Contact from "@/components/Contact.tsx";
import Footer from "@/components/Footer.tsx";
import dayjs from "dayjs";

// Fetch all events and sort by date
const allEvents = await getCollection("events");

const now = dayjs();

const upcomingEvents = allEvents
    .filter((event) => dayjs(event.data.date).isAfter(now))
    .sort((a, b) => dayjs(a.data.date).diff(b.data.date));

const pastEvents = allEvents
    .filter((event) => dayjs(event.data.date).isBefore(now))
    .sort((a, b) => dayjs(b.data.date).diff(a.data.date));
---

<Layout title="Siligong Gamedev - Wollongong Game Development Community">
    <div class="min-h-screen">
        <Hero />
        <About />
        <Events client:load upcoming={upcomingEvents} past={pastEvents} />
        <Community />
        <Contact />
        <Footer />
    </div>
</Layout>
